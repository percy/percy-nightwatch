<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lazy Loading Test - Percy Nightwatch E2E</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f7fa;
      color: #333;
    }

    header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 40px 20px;
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }

    .scroll-indicator {
      background: rgba(255, 255, 255, 0.2);
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      display: inline-block;
    }

    .scroll-indicator strong {
      color: #ffd700;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 30px 20px;
    }

    .info-box {
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
      border-left: 4px solid #667eea;
    }

    .info-box h2 {
      color: #667eea;
      margin-bottom: 15px;
    }

    .info-box ul {
      list-style-position: inside;
      line-height: 1.8;
      color: #555;
    }

    .image-section {
      margin-bottom: 40px;
    }

    .image-section h3 {
      color: #667eea;
      margin-bottom: 15px;
      font-size: 1.5rem;
    }

    .image-wrapper {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
      min-height: 400px;
      position: relative;
    }

    .image-wrapper.loading::before {
      content: '‚è≥ Loading...';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.5rem;
      color: #667eea;
      font-weight: bold;
    }

    .lazy-image {
      width: 100%;
      height: auto;
      border-radius: 8px;
      display: none;
    }

    .lazy-image.loaded {
      display: block;
      animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .depth-marker {
      background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
      color: white;
      padding: 20px;
      text-align: center;
      font-size: 1.3rem;
      font-weight: bold;
      border-radius: 12px;
      margin: 40px 0;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
    }

    .depth-marker .depth-value {
      font-size: 2rem;
      color: #ffd700;
    }

    .stats-box {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(102, 126, 234, 0.95);
      color: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      min-width: 200px;
    }

    .stats-box h4 {
      margin-bottom: 10px;
      border-bottom: 2px solid rgba(255, 255, 255, 0.3);
      padding-bottom: 8px;
    }

    .stats-box p {
      margin: 5px 0;
      font-size: 0.9rem;
    }

    .stats-box .stat-value {
      color: #ffd700;
      font-weight: bold;
    }

    footer {
      background: #2d3748;
      color: white;
      padding: 30px 20px;
      text-align: center;
      margin-top: 50px;
    }

    .placeholder-img {
      width: 100%;
      height: 350px;
      background: linear-gradient(135deg, #e0e7ff 0%, #cffafe 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      font-size: 1.2rem;
      color: #667eea;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <header>
    <h1>üñºÔ∏è Lazy Loading Test Page</h1>
    <p style="font-size: 1.1rem; margin-top: 10px;">Testing slow scroll to bottom functionality</p>
    <div class="scroll-indicator">
      Current Scroll: <strong id="current-scroll">0px</strong> |
      Page Height: <strong id="page-height">Calculating...</strong>
    </div>
  </header>

  <div class="container">
    <div class="info-box">
      <h2>About This Test</h2>
      <p style="margin-bottom: 15px;">
        This page tests the Percy Nightwatch SDK's lazy loading support through the
        <code>slowScrollToBottom()</code> function. The page is over 5000px tall with
        images that only load when scrolled into view.
      </p>
      <h3 style="color: #667eea; margin: 15px 0 10px 0;">Features Tested:</h3>
      <ul>
        <li><strong>PERCY_ENABLE_LAZY_LOADING_SCROLL</strong> - Enable lazy scroll before snapshot</li>
        <li><strong>PERCY_LAZY_LOAD_SCROLL_TIME</strong> - Configurable scroll timing (default 0.45s)</li>
        <li><strong>BYPASS_SCROLL_TO_TOP</strong> - Skip scrolling back to top</li>
        <li><strong>PERCY_SLEEP_AFTER_LAZY_LOAD_COMPLETE</strong> - Wait time after scroll complete</li>
        <li>Maximum scroll height limit (25,000px)</li>
        <li>Page-by-page scrolling based on client height</li>
      </ul>
    </div>

    <!-- Image Section 1 -->
    <div class="depth-marker">
      <div>Scroll Depth Marker</div>
      <div class="depth-value" data-depth="0">0px</div>
    </div>

    <div class="image-section">
      <h3>Section 1: Top of Page</h3>
      <div class="image-wrapper loading">
        <div class="placeholder-img" data-index="1">Image 1 - Depth: 250px</div>
        <img class="lazy-image" data-src="https://via.placeholder.com/900x350/667eea/ffffff?text=Image+1" alt="Lazy Image 1">
      </div>
      <div class="image-wrapper loading">
        <div class="placeholder-img" data-index="2">Image 2 - Depth: 750px</div>
        <img class="lazy-image" data-src="https://via.placeholder.com/900x350/764ba2/ffffff?text=Image+2" alt="Lazy Image 2">
      </div>
    </div>

    <div class="depth-marker">
      <div>Scroll Depth Marker</div>
      <div class="depth-value" data-depth="1000">~1000px</div>
    </div>

    <!-- Image Section 2 -->
    <div class="image-section">
      <h3>Section 2: Quarter Way Down</h3>
      <div class="image-wrapper loading">
        <div class="placeholder-img" data-index="3">Image 3 - Depth: 1250px</div>
        <img class="lazy-image" data-src="https://via.placeholder.com/900x350/667eea/ffffff?text=Image+3" alt="Lazy Image 3">
      </div>
      <div class="image-wrapper loading">
        <div class="placeholder-img" data-index="4">Image 4 - Depth: 1750px</div>
        <img class="lazy-image" data-src="https://via.placeholder.com/900x350/764ba2/ffffff?text=Image+4" alt="Lazy Image 4">
      </div>
    </div>

    <div class="depth-marker">
      <div>Scroll Depth Marker</div>
      <div class="depth-value" data-depth="2000">~2000px</div>
    </div>

    <!-- Image Section 3 -->
    <div class="image-section">
      <h3>Section 3: Halfway Point</h3>
      <div class="image-wrapper loading">
        <div class="placeholder-img" data-index="5">Image 5 - Depth: 2250px</div>
        <img class="lazy-image" data-src="https://via.placeholder.com/900x350/667eea/ffffff?text=Image+5" alt="Lazy Image 5">
      </div>
      <div class="image-wrapper loading">
        <div class="placeholder-img" data-index="6">Image 6 - Depth: 2750px</div>
        <img class="lazy-image" data-src="https://via.placeholder.com/900x350/764ba2/ffffff?text=Image+6" alt="Lazy Image 6">
      </div>
    </div>

    <div class="depth-marker">
      <div>Scroll Depth Marker</div>
      <div class="depth-value" data-depth="3000">~3000px</div>
    </div>

    <!-- Image Section 4 -->
    <div class="image-section">
      <h3>Section 4: Three Quarters Down</h3>
      <div class="image-wrapper loading">
        <div class="placeholder-img" data-index="7">Image 7 - Depth: 3250px</div>
        <img class="lazy-image" data-src="https://via.placeholder.com/900x350/667eea/ffffff?text=Image+7" alt="Lazy Image 7">
      </div>
      <div class="image-wrapper loading">
        <div class="placeholder-img" data-index="8">Image 8 - Depth: 3750px</div>
        <img class="lazy-image" data-src="https://via.placeholder.com/900x350/764ba2/ffffff?text=Image+8" alt="Lazy Image 8">
      </div>
    </div>

    <div class="depth-marker">
      <div>Scroll Depth Marker</div>
      <div class="depth-value" data-depth="4000">~4000px</div>
    </div>

    <!-- Image Section 5 -->
    <div class="image-section">
      <h3>Section 5: Near Bottom</h3>
      <div class="image-wrapper loading">
        <div class="placeholder-img" data-index="9">Image 9 - Depth: 4250px</div>
        <img class="lazy-image" data-src="https://via.placeholder.com/900x350/667eea/ffffff?text=Image+9" alt="Lazy Image 9">
      </div>
      <div class="image-wrapper loading">
        <div class="placeholder-img" data-index="10">Image 10 - Depth: 4750px</div>
        <img class="lazy-image" data-src="https://via.placeholder.com/900x350/764ba2/ffffff?text=Image+10" alt="Lazy Image 10">
      </div>
    </div>

    <div class="depth-marker">
      <div>Scroll Depth Marker</div>
      <div class="depth-value" data-depth="5000">~5000px</div>
    </div>

    <!-- Image Section 6 -->
    <div class="image-section">
      <h3>Section 6: Bottom of Page</h3>
      <div class="image-wrapper loading">
        <div class="placeholder-img" data-index="11">Image 11 - Depth: 5250px</div>
        <img class="lazy-image" data-src="https://via.placeholder.com/900x350/667eea/ffffff?text=Image+11" alt="Lazy Image 11">
      </div>
      <div class="image-wrapper loading">
        <div class="placeholder-img" data-index="12">Image 12 - Depth: 5750px</div>
        <img class="lazy-image" data-src="https://via.placeholder.com/900x350/764ba2/ffffff?text=Image+12" alt="Lazy Image 12">
      </div>
    </div>
  </div>

  <footer>
    <h3>End of Page</h3>
    <p style="margin-top: 10px;">All images should be loaded after lazy scroll completes</p>
    <p style="margin-top: 5px; opacity: 0.7;">Total Page Height: <span id="total-height">Calculating...</span></p>
  </footer>

  <!-- Fixed Stats Box -->
  <div class="stats-box">
    <h4>üìä Load Statistics</h4>
    <p>Loaded Images: <span class="stat-value" id="loaded-count">0</span> / <span id="total-images">12</span></p>
    <p>Scroll Progress: <span class="stat-value" id="scroll-percent">0%</span></p>
    <p>Window Height: <span class="stat-value" id="window-height">0px</span></p>
  </div>

  <script>
    // Intersection Observer for lazy loading
    const imageObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const img = entry.target;
          const wrapper = img.parentElement;
          const placeholder = wrapper.querySelector('.placeholder-img');

          img.src = img.dataset.src;
          img.onload = () => {
            img.classList.add('loaded');
            if (placeholder) placeholder.style.display = 'none';
            wrapper.classList.remove('loading');
            updateStats();
          };
          imageObserver.unobserve(img);
        }
      });
    }, {
      rootMargin: '50px'
    });

    // Observe all lazy images
    document.querySelectorAll('.lazy-image').forEach(img => {
      imageObserver.observe(img);
    });

    // Update scroll and statistics
    function updateStats() {
      const scrollY = window.pageYOffset || document.documentElement.scrollTop;
      const windowHeight = window.innerHeight;
      const documentHeight = Math.max(
        document.body.scrollHeight,
        document.body.offsetHeight,
        document.documentElement.clientHeight,
        document.documentElement.scrollHeight,
        document.documentElement.offsetHeight
      );

      const scrollPercent = Math.round((scrollY / (documentHeight - windowHeight)) * 100);
      const loadedImages = document.querySelectorAll('.lazy-image.loaded').length;

      document.getElementById('current-scroll').textContent = scrollY.toFixed(0) + 'px';
      document.getElementById('page-height').textContent = documentHeight + 'px';
      document.getElementById('total-height').textContent = documentHeight + 'px';
      document.getElementById('loaded-count').textContent = loadedImages;
      document.getElementById('scroll-percent').textContent = Math.min(scrollPercent, 100) + '%';
      document.getElementById('window-height').textContent = windowHeight + 'px';
    }

    // Update on scroll
    window.addEventListener('scroll', updateStats);

    // Initial update
    updateStats();
  </script>
</body>
</html>
